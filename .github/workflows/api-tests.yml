name: Testes de API com Newman e Postman

on:
  push:
    branches:
      - main # O workflow ser√° acionado sempre que houver um push para o branch 'main'

jobs:
  run-api-tests:
    runs-on: ubuntu-latest # O job ser√° executado em um ambiente Ubuntu

    steps:
    - name: ‚¨áÔ∏è Checkout do C√≥digo
      uses: actions/checkout@v4
      with:
        # Garante que todo o hist√≥rico seja buscado, se necess√°rio, para artefatos ou outras opera√ß√µes
        fetch-depth: 0 
      # Documenta√ß√£o: Este passo faz o clone do seu reposit√≥rio para o ambiente de execu√ß√£o do GitHub Actions.
      # √â essencial para que o workflow tenha acesso aos seus arquivos de cole√ß√£o do Postman.

    - name: ‚öôÔ∏è Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18' # Voc√™ pode ajustar a vers√£o do Node.js conforme sua prefer√™ncia ou necessidade
      # Documenta√ß√£o: Este passo instala a vers√£o especificada do Node.js no ambiente.
      # O Newman √© um pacote Node.js, ent√£o precisamos do Node.js instalado para execut√°-lo.

    - name: üöÄ Instalar Newman e htmlextra Reporter
      run: npm install -g newman newman-reporter-htmlextra
      # Documenta√ß√£o: Instala globalmente o Newman e o reporter HTML extra.
      # 'npm install -g' instala pacotes Node.js globalmente, tornando-os acess√≠veis a partir da linha de comando.

    - name: üß™ Executar Testes de API
      run: newman run ./Swagger_PetsStore_postman_.json -r htmlextra --reporter-htmlextra-title Relat√≥rio --reporter-htmlextra-titleSize 3 --reporter-htmlextra-testPaging --reporter-htmlextra-browserTitle Testes --reporter-htmlextra-omitHeaders
      # Documenta√ß√£o: Este √© o comando principal que executa seus testes.
      # Certifique-se de que o caminho para o seu arquivo .json da cole√ß√£o esteja correto em rela√ß√£o √† raiz do seu reposit√≥rio.
      # Aqui, assumimos que 'Swagger_PetsStore_postman_.json' est√° na raiz do seu reposit√≥rio.

    - name: üì§ Publicar Relat√≥rio de Testes
      uses: actions/upload-artifact@v4
      with:
        name: Relatorio-Newman-API-Tests
        path: newman # O Newman gera o relat√≥rio dentro de uma pasta 'newman' por padr√£o.
      # Documenta√ß√£o: Este passo empacota os arquivos gerados (o relat√≥rio HTML) e os disponibiliza como "artefatos" do workflow.
      # Voc√™ poder√° baixar esses artefatos na p√°gina do GitHub Actions ap√≥s a execu√ß√£o do workflow.
      # A pasta 'newman' √© onde o newman-reporter-htmlextra salva os relat√≥rios por padr√£o.
